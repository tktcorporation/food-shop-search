# Google Maps API 料金試算

このドキュメントは、ペコサーチで使用しているGoogle Maps APIの料金試算をまとめたものです。

> 最終更新: 2026-01-29

## 使用しているAPI一覧

| API                              | 用途           | 料金 (/1,000回) | 月間無料枠 |
| -------------------------------- | -------------- | --------------- | ---------- |
| Maps JavaScript API              | 地図表示       | $7.00           | 10,000回   |
| Places API - Nearby Search (Pro) | レストラン検索 | $32.00          | 5,000回    |
| Places API - Autocomplete        | 駅名補完       | $2.83           | 10,000回   |
| Geocoding API                    | 座標変換       | $5.00           | 10,000回   |

※ 料金は2025年3月以降のGoogle Maps Platform料金体系に基づく

## 最適化済み: Place Details API の廃止

**2026-01-29の最適化により、Place Details API の呼び出しを完全に廃止しました。**

### 変更内容

| 項目                   | 変更前                  | 変更後              |
| ---------------------- | ----------------------- | ------------------- |
| Place Details 呼び出し | 20回/検索               | **0回**             |
| 営業状態の取得方法     | `weekday_text` をパース | `isOpen()` メソッド |
| 1検索あたりコスト      | $0.51                   | **$0.17**           |
| コスト削減率           | -                       | **67%**             |

### 技術的な変更

Nearby Search の結果には以下の情報が含まれており、Place Details を呼ぶ必要がなくなりました:

- `rating`, `user_ratings_total` - 評価情報
- `price_level` - 価格帯
- `photos` - 写真（1枚）
- `opening_hours.isOpen()` - 営業中かどうか
- `vicinity` - 住所
- `geometry` - 位置情報

## 1回の検索操作でのAPI呼び出し

### キャッシュなし（最悪ケース）

| 操作                  | API             | 呼び出し数 |
| --------------------- | --------------- | ---------- |
| ページ表示            | Maps JavaScript | 1回        |
| 駅名入力              | Autocomplete    | 1回        |
| 駅選択                | Geocoding       | 1回        |
| キーワード検索（5個） | Nearby Search   | 5回        |

## コスト内訳（1回の検索あたり）

| API                     | 呼び出し数 | 単価     | 費用       | 割合 |
| ----------------------- | ---------- | -------- | ---------- | ---- |
| **Nearby Search (Pro)** | 5回        | $0.032   | $0.16      | 91%  |
| Geocoding               | 1回        | $0.005   | $0.005     | 3%   |
| Autocomplete            | 1回        | $0.00283 | $0.003     | 2%   |
| Maps JS Load            | 1回        | $0.007   | $0.007     | 4%   |
| **合計**                |            |          | **$0.175** | 100% |

## キャッシュによるコスト削減

`src/utils/cacheManager.ts` で定義されたキャッシュ設定:

| キャッシュ          | 有効期限 | 効果                              |
| ------------------- | -------- | --------------------------------- |
| GEOCODE_FORWARD     | 7日間    | 同じ駅の再検索でGeocoding不要     |
| RESTAURANT_SEARCH   | 48時間   | 同条件の再検索でNearby Search不要 |
| STATION_PREDICTIONS | 24時間   | 駅検索候補のキャッシュ            |

### キャッシュヒット率の影響

| キャッシュ率 | 月2,500検索時の費用 |
| ------------ | ------------------- |
| 0%（なし）   | 約$438              |
| 30%          | 約$306              |
| 50%          | 約$219              |
| 70%          | 約$131              |

## 月間料金試算

### シナリオ別試算（キャッシュヒット率30%想定）

| 利用規模 | ユーザー数 | 検索/人 | 月間検索 | 月額費用 |
| -------- | ---------- | ------- | -------- | -------- |
| 個人利用 | 1人        | 50回    | 50回     | 無料枠内 |
| 小規模   | 50人       | 10回    | 500回    | 約$50    |
| 中規模   | 250人      | 10回    | 2,500回  | 約$300   |
| 大規模   | 1,000人    | 10回    | 10,000回 | 約$1,400 |

### 無料で使える範囲

月間無料枠を超えないための目安: **約700〜800回の検索**

（Place Details 廃止前の約3倍に拡大）

## 最適化前との比較

| 利用規模 | 最適化前  | 最適化後      | 削減額     |
| -------- | --------- | ------------- | ---------- |
| 小規模   | $150/月   | **$50/月**    | -$100/月   |
| 中規模   | $1,000/月 | **$300/月**   | -$700/月   |
| 大規模   | $4,500/月 | **$1,400/月** | -$3,100/月 |

## さらなる最適化オプション

### オプション1: キーワード数を減らす

| キーワード数 | Nearby Search費用/検索 | 削減率 |
| ------------ | ---------------------- | ------ |
| 5個（現状）  | $0.16                  | -      |
| 3個          | $0.096                 | 40%    |
| 2個          | $0.064                 | 60%    |

### オプション2: キャッシュ期間を延長

現在のキャッシュ期間を延長することで、キャッシュヒット率を向上させられます。

## 参考リンク

- [Google Maps Platform Pricing](https://mapsplatform.google.com/pricing/)
- [Places API Usage and Billing](https://developers.google.com/maps/documentation/places/web-service/usage-and-billing)
- [Geocoding API Usage and Billing](https://developers.google.com/maps/documentation/geocoding/usage-and-billing)
- [Google Maps Platform 2025年3月の変更](https://developers.google.com/maps/billing-and-pricing/march-2025)

## 注意事項

- 料金は2025年3月以降のGoogle Maps Platform料金体系に基づいています
- 実際の料金はGoogleの価格改定により変動する可能性があります
- キャッシュヒット率は実際の利用パターンにより異なります
- 大量利用時はGoogleとの個別契約によるボリュームディスカウントが適用される場合があります
